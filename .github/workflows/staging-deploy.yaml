name: staging-deploy

on:
  push:
    branches:
      - 'staging-prepare'

jobs:
  staging-deploy:
    if: github.event.repository.fork == false
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
        with:
          fetch-depth: '0'
      - run: chmod +x ./md && ./md ./.github/config.sh
      - uses: dart-lang/setup-dart@v1.3
        with:
          sdk: ${{env.DART_VERSION}}
      - uses: actions/checkout@v3
        with:
          repository: nunuazaidi/shed
          token: ${{secrets.SHED_ACCESS_TOKEN}}
          path: ./shed
      - run: ./md ./.github/compile.sh
      - run: ./md ./.github/staging_deploy.sh